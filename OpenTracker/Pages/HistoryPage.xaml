<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="OpenTracker.Pages.HistoryPage"
             BackgroundColor="#121212"
             Title="History">

    <RefreshView IsRefreshing="{Binding IsLoading}" Command="{Binding RefreshCommand}" RefreshColor="#2196F3">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="25">

                <Label Text="Weekly Activity" TextColor="#2196F3" FontSize="12" FontAttributes="Bold" />

                <Border BackgroundColor="#1E1E1E" Stroke="Transparent" Padding="15" StrokeShape="RoundRectangle 6"
                        HeightRequest="220">
                    <Grid RowDefinitions="*, Auto">
                        <CollectionView Grid.Row="0" ItemsSource="{Binding ChartData}" VerticalOptions="End">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="15" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <VerticalStackLayout VerticalOptions="End" Spacing="5" WidthRequest="30">
                                        <Label Text="{Binding ValueLabel}" TextColor="#888" FontSize="10"
                                               HorizontalOptions="Center" />
                                        <BoxView Color="{Binding ColorHex}"
                                                 HeightRequest="{Binding Height}"
                                                 WidthRequest="12"
                                                 CornerRadius="4"
                                                 HorizontalOptions="Center" />
                                        <Label Text="{Binding DayName}" TextColor="White" FontSize="12"
                                               HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Grid>
                </Border>

                <Label Text="Recent Sessions" TextColor="#2196F3" FontSize="12" FontAttributes="Bold" Margin="0,10,0,0" />

                <CollectionView ItemsSource="{Binding HistoryList}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="10" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="#1E1E1E" Stroke="#333" StrokeShape="RoundRectangle 6" Padding="15">
                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout Grid.Column="0" Spacing="2">
                                        <Label Text="{Binding TrackerName}" TextColor="White" FontAttributes="Bold"
                                               FontSize="16" />
                                        <Label Text="{Binding StartTime, StringFormat='{0:MMM dd, yyyy  h:mm tt}'}"
                                               TextColor="Gray" FontSize="12" />
                                    </VerticalStackLayout>

                                    <Label Grid.Column="1" Text="{Binding DurationDisplay}" TextColor="#2196F3"
                                           FontAttributes="Bold" VerticalOptions="Center" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <Label Text="No history yet." TextColor="Gray" HorizontalOptions="Center" Margin="0,50" />
                    </CollectionView.EmptyView>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>